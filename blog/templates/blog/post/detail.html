{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load blog_tags %}


{% block title %}{{ post.title }}{% endblock %}
{% block content %}

<div class="container col-lg-auto" style="padding-right: 10px;">
    <div class="row clearfix">
        <div class="col-lg-12 col-md-12 left-box">
            <div class="card">
                <div class="body">
                    <div class="img-post">
                        <img class="d-block img-fluid" src="{% if post.image %}{{ post.image.url }}{% else %} {% static 'img/no_img.png' %}{% endif %}">
                    </div>
                    <h2><a href="{{post.get_absolute_url}}">{{ post.title }}</a></h2>
                    <p class="date">
                        Published {{ post.publish }} by {{ post.author }}
                    </p>
                    {% if request.user == post.author %}
                    <p>
                        <a href="{% url 'blog:edit_post' post.id %}">Edit post</a>
                    </p>
                    <p>
                        <a href="{% url 'blog:delete_post' post.id %}">Delete post</a>
                    </p>
                    {% endif %}
                    <p>
                        <a href="{% url 'blog:post_share' post.id %}">Share this post</a>
                    </p>
                </div>                   
            </div> 
            <span class="note">
                <p>
                    {{ post.body|markdown }}
                </p> 
            </span>

<div class="card">
    <div class="header">
        <h4>Similar posts</h4>
    <div class="row">
    {% for post in similiar_posts %}
    <div class="col col-sm-1 col-lg-4" style="padding:10px;">
    <p style="font-weight: bold; font-size: 100%;">
        <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
        <small> by {{ post.author }}</small>
    <p> {{ post.body|truncatewords:20}}</p>
    </p>
</div>
    {% empty %}
        There are no similar posts yet.
    {% endfor %}
    </div>
        {% with comments.count as total_comments %}
    <h3>
        {{ total_comments }} comment{{total_comments|pluralize }}
    </h3>
    {% endwith %}
    </div>
</nav>

{% for comment in comments %}
<div class="body breadcrumb">
    <ul class="comment-reply list-unstyled">
        <li class="row clearfix">
            <div class="icon-box col-md-2 col-4"><img class="img-fluid img-thumbnail" src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="Awesome Image"></div>
            <div class="text-box col-md-5 col-6 p-l-0 p-r0">
                <h5 class="m-b-0"> Comment {{ forloop.counter }} by {{ comment.owner.get_full_name }}</h5>
                <p>{{ comment.body | linebreaks }} </p>
                <ul class="list-inline">
                    <li><a href="javascript:void(0);">{{ comment.created }}</a></li>
                </ul>
            </div>
            </li>
    {% empty %}
     <p>There are no comments yet.</p>
    {% endfor %}
    </div>
</div>
</div>
<div class="container">
    <div class="header p-r0">
        {% if new_comment %}
        <div class="alert alert-success" role="alert">
            <h2>Your comment has been added.</h2>
        </div>
            
        {% elif request.user.is_authenticated %}
        <h4>Leave a reply </h4>
    </div>
    <div class="body">
        <div class="comment-form">
            <form method="POST" class="row clearfix">
                {% csrf_token %}
                <div class="form-group">
                        {{ comment_form.body|as_crispy_field }}
                </div>
                <button type="submit" class="btn btn-block btn-primary">SUBMIT</button>
        {% else %}
            <h5><a href="{% url 'login' %}">Log in</a> to leave a reply</h5>
            <small>Don't have an account yet?</small>
            <a href="{% url 'students:student_registration' %}">Sign Up Here</a>
            {% endif %}                    
            </form>
        </div>
    </div>
</div>
</div>

{% endblock %}












